(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[859],{1460:(e,s,r)=>{"use strict";r.d(s,{A:()=>n});var t=r(7620),o=r(96006),a=r(39039);function n(){let{data:e,status:s}=(0,o.useSession)(),{user:r,isAuthenticated:n,isLoading:l,error:i,setSession:u,login:d,logout:c,register:m,clearError:g}=(0,a.n)();(0,t.useEffect)(()=>{u(e)},[e,u]);let h=e=>(null==r?void 0:r.role)===e,p=e=>!!r&&e.includes(r.role);return{user:r,session:e,isAuthenticated:n,isLoading:l||"loading"===s,error:i,login:d,logout:c,register:m,clearError:g,hasRole:h,hasAnyRole:p,isAdmin:()=>h("ADMIN"),isProjectOwner:()=>h("PROJECT_OWNER"),canAccessAdmin:()=>p(["ADMIN","PROJECT_OWNER"])}}},2190:(e,s,r)=>{Promise.resolve().then(r.bind(r,79550))},27541:(e,s,r)=>{"use strict";var t=r(43041);r.o(t,"usePathname")&&r.d(s,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(s,{useRouter:function(){return t.useRouter}})},39039:(e,s,r)=>{"use strict";r.d(s,{n:()=>n});var t=r(21367),o=r(50848),a=r(96006);let n=(0,t.vt)()((0,o.lt)((e,s)=>({user:null,session:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(r,t)=>{e({isLoading:!0,error:null});try{let o=await (0,a.signIn)("credentials",{email:r,password:t,redirect:!1});if(null==o?void 0:o.error)return e({error:"Invalid email or password",isLoading:!1}),!1;return await s().refreshSession(),e({isLoading:!1}),!0}catch(s){return e({error:"Login failed. Please try again.",isLoading:!1}),!1}},logout:async()=>{e({isLoading:!0});try{await (0,a.signOut)({redirect:!1}),e({user:null,session:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(s){e({error:"Logout failed",isLoading:!1})}},refreshSession:async()=>{try{let s=await (0,a.getSession)();(null==s?void 0:s.user)?e({session:s,user:s.user,isAuthenticated:!0}):e({session:null,user:null,isAuthenticated:!1})}catch(s){console.error("Failed to refresh session:",s),e({session:null,user:null,isAuthenticated:!1})}},register:async r=>{e({isLoading:!0,error:null});try{let t="http://localhost:8000",o={email:r.email,password:r.password,first_name:r.firstName,last_name:r.lastName,company_name:r.companyName};console.log("=== API REQUEST DEBUG ==="),console.log("API URL:","".concat(t,"/api/v1/auth/register")),console.log("Request Body:",o),console.log("Request Headers:",{"Content-Type":"application/json",Accept:"application/json"});let a=await fetch("".concat(t,"/api/v1/auth/register"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)});if(console.log("=== API RESPONSE DEBUG ==="),console.log("Response Status:",a.status),console.log("Response Headers:",Object.fromEntries(a.headers.entries())),!a.ok){let s=await a.json();return console.log("Error Response Body:",s),console.log("Detailed Error:",{status:a.status,statusText:a.statusText,errorDetail:s.detail,fullError:s}),e({error:s.detail||"Registration failed",isLoading:!1}),!1}let n=await a.json();console.log("Success Response Body:",n),console.log("Registration successful! User created:",n.user);let l=await s().login(r.email,r.password);return e({isLoading:!1}),l}catch(s){return console.log("=== CATCH ERROR DEBUG ==="),console.error("Registration network/parsing error:",s),console.log("Error type:",typeof s),console.log("Error message:",s instanceof Error?s.message:"Unknown error"),e({error:"Registration failed. Please try again.",isLoading:!1}),!1}},clearError:()=>e({error:null}),setSession:s=>{(null==s?void 0:s.user)?e({session:s,user:s.user,isAuthenticated:!0}):e({session:null,user:null,isAuthenticated:!1})}}),{name:"auth-store"}))},79550:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>u});var t=r(54568),o=r(7620),a=r(27541),n=r(1460),l=r(39039);function i(e){let{onSuccess:s,redirectTo:r="/dashboard"}=e,n=(0,a.useRouter)(),{login:i,isLoading:u,error:d,clearError:c}=(0,l.n)(),[m,g]=(0,o.useState)(""),[h,p]=(0,o.useState)(""),[f,x]=(0,o.useState)(!1),y=async e=>{e.preventDefault(),c(),m&&h&&await i(m,h)&&(null==s||s(),n.push(r))};return(0,t.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),(0,t.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:m,onChange:e=>g(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsx)("input",{id:"password",name:"password",type:f?"text":"password",autoComplete:"current-password",required:!0,value:h,onChange:e=>p(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password"}),(0,t.jsx)("button",{type:"button",onClick:()=>x(!f),className:"absolute inset-y-0 right-0 px-3 flex items-center text-sm text-gray-600 hover:text-gray-800",children:f?"Hide":"Show"})]})]}),d&&(0,t.jsx)("div",{className:"text-red-600 text-sm bg-red-50 border border-red-200 rounded-md p-3",children:d}),(0,t.jsx)("button",{type:"submit",disabled:u||!m||!h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Signing in...":"Sign in"})]})}function u(){let e=(0,a.useRouter)(),{isAuthenticated:s}=(0,n.A)();return((0,o.useEffect)(()=>{s&&e.push("/dashboard")},[s,e]),s)?null:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to your account"}),(0,t.jsxs)("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Or"," ",(0,t.jsx)("a",{href:"/auth/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"create a new account"})]})]}),(0,t.jsx)("div",{className:"bg-white py-8 px-6 shadow rounded-lg",children:(0,t.jsx)(i,{})})]})})}}},e=>{e.O(0,[6,326,587,18,358],()=>e(e.s=2190)),_N_E=e.O()}]);