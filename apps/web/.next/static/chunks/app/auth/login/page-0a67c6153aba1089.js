(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[859],{1460:(e,r,s)=>{"use strict";s.d(r,{A:()=>n});var t=s(7620),a=s(6006),i=s(9039);function n(){let{data:e,status:r}=(0,a.useSession)(),{user:s,isAuthenticated:n,isLoading:l,error:o,setSession:d,login:u,logout:c,register:m,clearError:h}=(0,i.n)();(0,t.useEffect)(()=>{d(e)},[e,d]);let g=e=>(null==s?void 0:s.role)===e,p=e=>!!s&&e.includes(s.role);return{user:s,session:e,isAuthenticated:n,isLoading:l||"loading"===r,error:o,login:u,logout:c,register:m,clearError:h,hasRole:g,hasAnyRole:p,isAdmin:()=>g("ADMIN"),isProjectOwner:()=>g("PROJECT_OWNER"),canAccessAdmin:()=>p(["ADMIN","PROJECT_OWNER"])}}},2190:(e,r,s)=>{Promise.resolve().then(s.bind(s,9550))},9039:(e,r,s)=>{"use strict";s.d(r,{n:()=>l});var t=s(1367),a=s(848),i=s(6006),n=s(7011);let l=(0,t.vt)()((0,a.lt)((e,r)=>({user:null,session:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(s,t)=>{e({isLoading:!0,error:null});try{let a=await (0,i.signIn)("credentials",{email:s,password:t,redirect:!1});if(null==a?void 0:a.error)return e({error:"Invalid email or password",isLoading:!1}),!1;return await r().refreshSession(),e({isLoading:!1}),!0}catch(r){return e({error:"Login failed. Please try again.",isLoading:!1}),!1}},logout:async()=>{e({isLoading:!0});try{await (0,i.signOut)({redirect:!1}),e({user:null,session:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(r){e({error:"Logout failed",isLoading:!1})}},refreshSession:async()=>{try{let r=await (0,i.getSession)();(null==r?void 0:r.user)?e({session:r,user:{id:r.user.id,email:r.user.email,name:r.user.name||"",role:r.user.role},isAuthenticated:!0}):e({session:null,user:null,isAuthenticated:!1})}catch(r){console.error("Failed to refresh session:",r),e({session:null,user:null,isAuthenticated:!1})}},register:async s=>{e({isLoading:!0,error:null});try{let t=await fetch("".concat(n.env.NEXT_PUBLIC_API_URL,"/api/v1/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email,password:s.password,first_name:s.firstName,last_name:s.lastName,company_name:s.companyName})});if(!t.ok){let r=await t.json();return e({error:r.detail||"Registration failed",isLoading:!1}),!1}let a=await r().login(s.email,s.password);return e({isLoading:!1}),a}catch(r){return e({error:"Registration failed. Please try again.",isLoading:!1}),!1}},clearError:()=>e({error:null}),setSession:r=>{(null==r?void 0:r.user)?e({session:r,user:{id:r.user.id,email:r.user.email,name:r.user.name||"",role:r.user.role},isAuthenticated:!0}):e({session:null,user:null,isAuthenticated:!1})}}),{name:"auth-store"}))},9550:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>d});var t=s(4568),a=s(7620),i=s(7541),n=s(1460),l=s(9039);function o(e){let{onSuccess:r,redirectTo:s="/dashboard"}=e,n=(0,i.useRouter)(),{login:o,isLoading:d,error:u,clearError:c}=(0,l.n)(),[m,h]=(0,a.useState)(""),[g,p]=(0,a.useState)(""),[x,f]=(0,a.useState)(!1),b=async e=>{e.preventDefault(),c(),m&&g&&await o(m,g)&&(null==r||r(),n.push(s))};return(0,t.jsxs)("form",{onSubmit:b,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),(0,t.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:m,onChange:e=>h(e.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsx)("input",{id:"password",name:"password",type:x?"text":"password",autoComplete:"current-password",required:!0,value:g,onChange:e=>p(e.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password"}),(0,t.jsx)("button",{type:"button",onClick:()=>f(!x),className:"absolute inset-y-0 right-0 px-3 flex items-center text-sm text-gray-600 hover:text-gray-800",children:x?"Hide":"Show"})]})]}),u&&(0,t.jsx)("div",{className:"text-red-600 text-sm bg-red-50 border border-red-200 rounded-md p-3",children:u}),(0,t.jsx)("button",{type:"submit",disabled:d||!m||!g,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Signing in...":"Sign in"})]})}function d(){let e=(0,i.useRouter)(),{isAuthenticated:r}=(0,n.A)();return((0,a.useEffect)(()=>{r&&e.push("/dashboard")},[r,e]),r)?null:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to your account"}),(0,t.jsxs)("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Or"," ",(0,t.jsx)("a",{href:"/auth/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"create a new account"})]})]}),(0,t.jsx)("div",{className:"bg-white py-8 px-6 shadow rounded-lg",children:(0,t.jsx)(o,{})})]})})}}},e=>{e.O(0,[341,587,18,358],()=>e(e.s=2190)),_N_E=e.O()}]);